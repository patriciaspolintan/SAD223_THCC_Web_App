<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- ========== Boxicons ========== -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- ========== My CSS ========== -->
	<link rel="stylesheet" href="static/style.css">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"> </script>

	<title>THCC Dashboard</title>
</head>
<body>



	<!-- ========== SIDEBAR ========== -->
	<section id="sidebar" class="hide">
		<a href="{{ url_for('index') }}" class="brand">
			<i class='bx bxs-church'></i>
			<span class="text">THCC Web App</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="{{ url_for('index') }}" title="Dashboard">
					<i class='bx bxs-dashboard' ></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('unit_mgmt' ) }}" title="Unit Management">
					<i class='bx bxs-shopping-bag-alt' ></i>
					<span class="text">Unit Management</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('unit_record' ) }}" title="Unit Records">
					<i class='bx bxs-folder' ></i>
					<span class="text">Unit Records</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('payment_record' ) }}" title="Payment Records">
					<i class='bx bxs-bank' ></i>
					<span class="text">Payment Records</span>
				</a>
			</li>
			<li>
				<a href="{{ url_for('users_mgmt' ) }}" title="Users Management">
					<i class='bx bxs-user' ></i>
					<span class="text">Users Management</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="{{ url_for('login') }}" class="logout" title="Log Out">
					<i class='bx bxs-log-out-circle' ></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- ========== END OF SIDEBAR ========== -->



	<!-- ========== CONTENT ========== -->
	<section id="content">


		<!-- ========== NAVBAR ========== -->
		<nav>
			<i class='bx bx-menu' ></i>

			<form action="#">
				<!-- <div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search' ></i></button>
				</div> -->
			</form>

			<a href="#" class="profile">
                <i class='bx user-circle' ></i>
				<!-- <img src="img/people.png"> -->
                <h4>USER ROLE</h4>
			</a>
		</nav>
		<!-- ========== END OF NAVBAR ========== -->



		<!-- ========== MAIN ========== -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<!-- <ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul> -->
				</div>

			</div>

			<ul class="box-info">
				<li id="unitsSold">
					<i class='bx bxs-shopping-bag'></i>
					<span class="text">
						<h3>Loading...</h3>
						<p>Units Sold</p>
					</span>
				</li>
				<li id="unitsAvailable">
					<i class='bx bxs-shopping-bag'></i>
					<span class="text">
						<h3>Loading...</h3>
						<p>Units Available</p>
					</span>
				</li>
				<li id="totalSales">
					<i class='bx bxs-shopping-bag'></i>
					<span class="text">
						<h3>Loading...</h3>
						<p>Total Sales</p>
					</span>
				</li>
			</ul>

			<script>
				// Fetch units sold and available from Flask backend
				fetch('/total_sold_units')
					.then(response => response.json())
					.then(data => {
						document.getElementById('unitsSold').innerHTML = `
							<i class='bx bxs-shopping-bag'></i>
							<span class="text">
								<h3>${data.total_sold_units}</h3>
								<p>Units Sold</p>
							</span>`;
					});
				
				fetch('/total_available_units')
					.then(response => response.json())
					.then(data => {
						document.getElementById('unitsAvailable').innerHTML = `
							<i class='bx bxs-shopping-bag'></i>
							<span class="text">
								<h3>${data.total_available_units}</h3>
								<p>Units Available</p>
							</span>`;
					});

				fetch('/total_sales')
					.then(response => response.json())
					.then(data => {
						document.getElementById('totalSales').innerHTML = `
							<i class='bx bxs-shopping-bag'></i>
							<span class="text">
								<h3>${data.total_sales}</h3>
								<p>Total Sales</p>
							</span>`;
					});
				</script>

				<div class="table-data">
					<div class="order">
						<div class="head">
							<h3>Monthly Units Sold</h3>
							<canvas id="unitsSoldChart" width="400" height="200"></canvas>
						</div>
					</div>
					<div class="todo">
						<div class="head">
							<h3>Monthly Sales</h3>
							<canvas id="monthlySalesChart" width="400" height="200"></canvas>
						</div>
					</div>
				</div>


		</main>
		<!-- ========== END OF MAIN ========== -->

	</section>
	<!-- ========== END OF CONTENT ========== -->



	<script src="static/script.js"></script>
	<script>
fetch('/monthly_units_sold')
    .then(response => response.json())
    .then(data => {
        new Chart(document.getElementById('unitsSoldChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Monthly Units Sold',
                    data: data.data,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });

fetch('/monthly_sales')
    .then(response => response.json())
    .then(data => {
        new Chart(document.getElementById('monthlySalesChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Monthly Sales',
                    data: data.data,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });




	</script>
</body>
</html>